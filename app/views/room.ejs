<!DOCTYPE html>
<html>
  <head>
    <title>Room <%= url %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script src="/js/jquery-2.1.1.min.js"></script>
  </head>
  <body>
    <h1>Room <%= url %></h1>
    <p><%= message %></p>
    <hr>
    <p>
        Nickname: <%= nickname %> <br>
        Board URL: <%= url %> <br>
        Board Count: <%= bcount %> <br><br>
        <b>Members</b>
        <ul>
            <% for(i = 0; i < members.length; i++) { %>
                <li><%= members[i].nickname %></li>
            <% } %>
        </ul>

        <b>Moderators</b>
        <ul>
            <% for(i = 0; i < moderators.length; i++) { %>
                <li><%= moderators[i].nickname %></li>
            <% } %>
        </ul>

        <b>Online</b>
        <ul id="onlineusers">

        </ul>
    </p>

    <p><a href="/logout">Logout</a></p>

    <script src="https://cdn.socket.io/socket.io-1.2.1.js"></script>
    <script>
        var socket = io('http://localhost:3000');

        // run once
        socket.on('connect', function() {
            socket.emit('request_memberlist', { roomid: <%= roomid %> });
            socket.emit('adduser', {
                roomid: <%= roomid %>,
                nickname: '<%= nickname %>',
                userid: <%= userid %>
            });
        });

        socket.on('receive_memberlist', function(data) {
            for(var prop in data) {
                console.log('---- ' + prop + ' ---- ' + data[prop]);
                $('#onlineusers').append($('<li>').text(data[prop]));
            }
        });

        socket.on('newconnection', function(data) {
            console.log('eeeeeee');
            $('#onlineusers').append($('<li>').text(data.nickname));
        });

        socket.on('disconnection', function(data) {
            //$('#onlineusers').append($('<li>').text(data.nickname));
            console.log(data.nickname + ' disconnected.');
        });

        // run once
        // socket.on('disconnect', function() {
        //     socket.emit('removeuser', {
        //         roomid: <%= roomid %>,
        //         nickname: '<%= nickname %>',
        //         userid: <%= userid %>
        //     });
        // });
    </script>
  </body>
</html>
